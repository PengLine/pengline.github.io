<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>长剧本分镜智能体的架构实现 | 余一叶知秋尽</title><meta name="author" content="余一叶知秋尽"><meta name="copyright" content="余一叶知秋尽"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="该插件将自然语言剧本自动拆分为多个N秒长度的短视频片段脚本，以适用于 AI 视频生成模型，可直接用于“文生视频”。">
<meta property="og:type" content="article">
<meta property="og:title" content="长剧本分镜智能体的架构实现">
<meta property="og:url" content="https://pengline.github.io/2025/10/0194020a663c408fb500dd7532349519/index.html">
<meta property="og:site_name" content="余一叶知秋尽">
<meta property="og:description" content="该插件将自然语言剧本自动拆分为多个N秒长度的短视频片段脚本，以适用于 AI 视频生成模型，可直接用于“文生视频”。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://pengline.github.io/img/essay/1745748274531174574827442.webp">
<meta property="article:published_time" content="2025-10-28T16:00:00.000Z">
<meta property="article:modified_time" content="2025-10-30T14:42:37.887Z">
<meta property="article:author" content="余一叶知秋尽">
<meta property="article:tag" content="剧本分镜">
<meta property="article:tag" content="剧本拆分">
<meta property="article:tag" content="长剧本分镜">
<meta property="article:tag" content="长剧本视频生成">
<meta property="article:tag" content="LlamaIndex向量检索">
<meta property="article:tag" content="LangGraph流程编排">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pengline.github.io/img/essay/1745748274531174574827442.webp"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "长剧本分镜智能体的架构实现",
  "url": "https://pengline.github.io/2025/10/0194020a663c408fb500dd7532349519/",
  "image": "https://pengline.github.io/img/essay/1745748274531174574827442.webp",
  "datePublished": "2025-10-28T16:00:00.000Z",
  "dateModified": "2025-10-30T14:42:37.887Z",
  "author": [
    {
      "@type": "Person",
      "name": "余一叶知秋尽",
      "url": "https://pengline.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://pengline.github.io/2025/10/0194020a663c408fb500dd7532349519/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":30,"languages":{"author":"作者: 余一叶知秋尽","link":"链接: ","source":"来源: 余一叶知秋尽","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '长剧本分镜智能体的架构实现',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/font.css"><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="余一叶知秋尽" type="application/atom+xml">
</head><body><div id="web_bg" style="background-image: url(/img/rqerwc4u0er.webp);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src= "/img/20241215205335173426721579192.webp" data-lazy-src="/img/butterfly-icon.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">41</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">173</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">41</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list-ul"></i><span> 归档</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-outdent"></i><span> AI</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/ai/aigc/"><i class="fa-fw fas fa-cubes"></i><span> AIGC 创意平台</span></a></li><li><a class="site-page child" href="/ai/agent/medical/"><i class="fa-fw fas fa-medkit"></i><span> 医疗问答Agent</span></a></li><li><a class="site-page child" href="/ai/agent/stocks/"><i class="fa-fw fas fa-line-chart"></i><span> 股票分析Agent</span></a></li><li><a class="site-page child" href="/ai/agent/study/"><i class="fa-fw fas fa-book"></i><span> 教育学习Agent</span></a></li><li><a class="site-page child" href="/ai/agent/movie/"><i class="fa-fw fas fa-video"></i><span> 剧本创作Agent</span></a></li><li><a class="site-page child" href="/ai/agent/video/"><i class="fa-fw fas fa-cut"></i><span> 视频混剪Agent</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://github.com/HengLine/video-shot-agent"><i class="fa-fw fas fa-file-video"></i><span> 剧本分镜Agent</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-cogs"></i><span> 工具</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/tools/json/"><i class="fa-fw fas fa-cog"></i><span> JSON 工具集</span></a></li><li><a class="site-page child" href="/tools/image/compressor/"><i class="fa-fw fas fa-image"></i><span> 图像批量压缩</span></a></li><li><a class="site-page child" href="/tools/image/watermark/"><i class="fa-fw fas fa-image"></i><span> 图像添加水印</span></a></li><li><a class="site-page child" href="/tools/video/cropping/"><i class="fa-fw fas fa-cut"></i><span> 视频范围裁剪</span></a></li><li><a class="site-page child" href="/tools/video/watermark/"><i class="fa-fw fas fa-video"></i><span> 视频水印打码</span></a></li><li><a class="site-page child" href="/tools/download/"><i class="fa-fw fas fa-download"></i><span> 批量下载媒体</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-pencil-square"></i><span> 文学</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/literature/poems"><i class="fa-fw fas fa-align-center"></i><span> 三行诗集</span></a></li><li><a class="site-page child" href="/literature/classical"><i class="fa-fw fas fa-align-justify"></i><span> 诗词歌赋</span></a></li><li><a class="site-page child" href="/literature/modern"><i class="fa-fw fas fa-align-left"></i><span> 现代诗歌</span></a></li><li><a class="site-page child" href="/literature/journal"><i class="fa-fw fas fa-align-right"></i><span> 随心随笔</span></a></li><li><a class="site-page child" href="/literature/incomplete"><i class="fa-fw fas fa-columns"></i><span> 忘梦残句</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-commenting"></i><span> 交流</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/messageboard/"><i class="fa-fw fas fa-paper-plane"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/essay/1745748274531174574827442.webp);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src= "/img/20241215205335173426721579192.webp" data-lazy-src="/img/logo.png" alt="Logo"><span class="site-name">余一叶知秋尽</span></a><a class="nav-page-title" href="/"><span class="site-name">长剧本分镜智能体的架构实现</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list-ul"></i><span> 归档</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-outdent"></i><span> AI</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/ai/aigc/"><i class="fa-fw fas fa-cubes"></i><span> AIGC 创意平台</span></a></li><li><a class="site-page child" href="/ai/agent/medical/"><i class="fa-fw fas fa-medkit"></i><span> 医疗问答Agent</span></a></li><li><a class="site-page child" href="/ai/agent/stocks/"><i class="fa-fw fas fa-line-chart"></i><span> 股票分析Agent</span></a></li><li><a class="site-page child" href="/ai/agent/study/"><i class="fa-fw fas fa-book"></i><span> 教育学习Agent</span></a></li><li><a class="site-page child" href="/ai/agent/movie/"><i class="fa-fw fas fa-video"></i><span> 剧本创作Agent</span></a></li><li><a class="site-page child" href="/ai/agent/video/"><i class="fa-fw fas fa-cut"></i><span> 视频混剪Agent</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://github.com/HengLine/video-shot-agent"><i class="fa-fw fas fa-file-video"></i><span> 剧本分镜Agent</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-cogs"></i><span> 工具</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/tools/json/"><i class="fa-fw fas fa-cog"></i><span> JSON 工具集</span></a></li><li><a class="site-page child" href="/tools/image/compressor/"><i class="fa-fw fas fa-image"></i><span> 图像批量压缩</span></a></li><li><a class="site-page child" href="/tools/image/watermark/"><i class="fa-fw fas fa-image"></i><span> 图像添加水印</span></a></li><li><a class="site-page child" href="/tools/video/cropping/"><i class="fa-fw fas fa-cut"></i><span> 视频范围裁剪</span></a></li><li><a class="site-page child" href="/tools/video/watermark/"><i class="fa-fw fas fa-video"></i><span> 视频水印打码</span></a></li><li><a class="site-page child" href="/tools/download/"><i class="fa-fw fas fa-download"></i><span> 批量下载媒体</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-pencil-square"></i><span> 文学</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/literature/poems"><i class="fa-fw fas fa-align-center"></i><span> 三行诗集</span></a></li><li><a class="site-page child" href="/literature/classical"><i class="fa-fw fas fa-align-justify"></i><span> 诗词歌赋</span></a></li><li><a class="site-page child" href="/literature/modern"><i class="fa-fw fas fa-align-left"></i><span> 现代诗歌</span></a></li><li><a class="site-page child" href="/literature/journal"><i class="fa-fw fas fa-align-right"></i><span> 随心随笔</span></a></li><li><a class="site-page child" href="/literature/incomplete"><i class="fa-fw fas fa-columns"></i><span> 忘梦残句</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-commenting"></i><span> 交流</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/messageboard/"><i class="fa-fw fas fa-paper-plane"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">长剧本分镜智能体的架构实现</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-10-28T16:00:00.000Z" title="发表于 2025-10-29 00:00:00">2025-10-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-10-30T14:42:37.887Z" title="更新于 2025-10-30 22:42:37">2025-10-30</time></span></div><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/AI/">AI</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/AI/Agent/">Agent</a></span><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>该工具能将用户提供的原始自然语言剧本，自动拆分为多个<strong>n秒长度的短视频片段脚本</strong>，并确保<strong>画面连贯性、角色一致性、动作延续性</strong>，适用于主流 AI 视频生成模型（如 Runway、Pika、Sora、Wan、Stable Video等）</p>
<blockquote>
<p>详细的使用方式，请参照本人开源的 GitHub 项目：<a target="_blank" rel="noopener" href="https://github.com/HengLine/tool-shot-agent">剧本分镜智能体</a>（功能开发完善中）</p>
<p>如果有更好的思路或想法，可参与开发或提出需求。</p>
</blockquote>
<h2 id="剧本分镜智能体"><a target="_blank" rel="noopener" href="https://github.com/HengLine/tool-shot-agent">剧本分镜智能体</a></h2>
<h3 id="核心目标">核心目标</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p>将任意长度剧本 → 拆分为 n 秒/段 的短视频脚本单元（Shot）</p>
</li>
<li class="lvl-2">
<p>每段包含：画面描述 + 角色动作 + 对话（如有）+ 镜头语言</p>
</li>
<li class="lvl-2">
<p>保证跨片段连续性（角色外观、位置、情绪、动作状态一致）</p>
</li>
<li class="lvl-2">
<p>输出格式兼容主流 AI 视频生成平台（文本提示词格式）</p>
</li>
</ul>
<h3 id="使用场景">使用场景</h3>
<p><strong>短视频内容创作</strong></p>
<ul class="lvl-0">
<li class="lvl-2">
<p>将小说章节转换为短视频分镜脚本</p>
</li>
<li class="lvl-2">
<p>为广告创意生成详细的镜头规划</p>
</li>
<li class="lvl-2">
<p>自动将剧本拆分为社交媒体短视频格式</p>
</li>
</ul>
<p><strong>影视前期制作辅助</strong></p>
<ul class="lvl-0">
<li class="lvl-2">
<p>快速生成剧本的视觉化预览</p>
</li>
<li class="lvl-2">
<p>辅助导演进行镜头规划和调度</p>
</li>
<li class="lvl-2">
<p>为分镜头绘制提供详细参考</p>
</li>
</ul>
<p><strong>教育培训应用</strong></p>
<ul class="lvl-0">
<li class="lvl-2">
<p>为教学内容创建情景化视频脚本</p>
</li>
<li class="lvl-2">
<p>将复杂概念通过分镜形式直观呈现</p>
</li>
<li class="lvl-2">
<p>辅助培训视频的标准化制作</p>
</li>
</ul>
<h3 id="输入输出">输入输出</h3>
<p>输入，自然语言</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[场景：城市咖啡馆，下午3点]</span><br><span class="line">李明坐在靠窗的位置，低头看着手机。突然，他抬头看见前女友小雨走进来。他愣住，手机差点掉到地上。小雨也看见了他，犹豫了一下，还是走了过来。</span><br><span class="line">小雨：（轻声）好久不见。</span><br><span class="line">李明：（紧张）你……你怎么在这？</span><br></pre></td></tr></table></figure>
<p>分镜输出示例（基于上文剧本）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Shot 1（0–5秒）</span><br><span class="line">AI Prompt:</span><br><span class="line">&quot;A young man (Li Ming) sits alone at a window table in a cozy cafe, afternoon sunlight streaming in. He stares intently at his smartphone. Medium shot, calm atmosphere, realistic style.&quot;</span><br><span class="line"></span><br><span class="line">Shot 2（5–10秒）</span><br><span class="line">AI Prompt:</span><br><span class="line">&quot;Li Ming suddenly looks up toward the cafe entrance, eyes wide in shock. His phone begins to slip from his left hand, halfway to the table. Medium close-up, shallow depth of field, natural lighting. Background slightly blurred.&quot;</span><br><span class="line"></span><br><span class="line">Shot 3（10–15秒）</span><br><span class="line">AI Prompt:</span><br><span class="line">&quot;A woman (Xiao Yu) enters the cafe, sees Li Ming, and pauses. She hesitates, then walks slowly toward his table. Over-the-shoulder shot from Li Ming&#x27;s perspective, soft focus on her face showing uncertainty.&quot;</span><br><span class="line"></span><br><span class="line">Shot 4（15–20秒）</span><br><span class="line">AI Prompt:</span><br><span class="line">&quot;Xiao Yu stands beside Li Ming&#x27;s table. She says softly: &#x27;Long time no see.&#x27; Li Ming looks up nervously, hands gripping the edge of the table. Two-shot, eye-level, warm cafe lighting.&quot;</span><br></pre></td></tr></table></figure>
<p>智能体返回结果：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;job_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shotgen_20251028_38eb0184&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;input_script&quot;</span><span class="punctuation">:</span> <span class="string">&quot;深夜11点，城市公寓客厅，窗外大雨滂沱。林然裹着旧羊毛毯蜷在沙发里，电视静音播放着黑白老电影。茶几上半杯凉茶已凝出水雾，旁边摊开一本旧相册。手机突然震动，屏幕亮起“未知号码”。她盯着看了三秒，指尖悬停在接听键上方，喉头轻轻滚动。终于，她按下接听，将手机贴到耳边。电话那头沉默两秒，传来一个沙哑的男声：“是我。”  林然的手指瞬间收紧，指节泛白，呼吸停滞了一瞬。  她声音微颤：“……陈默？你还好吗？”  对方停顿片刻，低声说：“我回来了。” 林然猛地坐直，瞳孔收缩，泪水在眼眶中打转。她张了张嘴，却发不出声音，只有毛毯从肩头滑落。”&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;style&quot;</span><span class="punctuation">:</span> <span class="string">&quot;realistic&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;duration_per_shot&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;total_shots&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;total_duration_sec&quot;</span><span class="punctuation">:</span> <span class="number">15</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;shots&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;shot_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;time_range_sec&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="number">5</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;scene_context&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span> <span class="string">&quot;城市老式公寓的客厅&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;深夜23:30，暴雨倾盆，雷声低鸣&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;atmosphere&quot;</span><span class="punctuation">:</span> <span class="string">&quot;安静、紧张，电视静音播放一部黑白老电影，画面闪烁微光；窗外雨幕如织，灯光在湿漉漉的地面上晕染成片；茶几上摊开一本泛黄的相册，照片中是多年前的合影，旁边是一杯未喝完的凉茶，杯壁凝着水珠&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;actions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;裹着毛毯蜷坐在沙发上&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;平静&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;身体放松，靠在沙发背上，目光柔和，双手轻轻裹紧毛毯&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手机震动&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;警觉&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;目光转向手机，身体微微前倾，手指轻触沙发扶手&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;接起电话，将手机贴在耳边&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;警觉&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手指微微颤抖，耳朵贴近手机，呼吸变得轻缓&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;电话那头传来：&#x27;是我&#x27;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;震惊&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;身体瞬间僵直，手指关节因握力过猛而泛白，呼吸凝滞&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;轻声问：&#x27;陈默？&#x27;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;试探+紧张&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手指收紧，声音轻微颤抖，身体微微前倾&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;听到对方说：&#x27;我回来了&#x27;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;震惊+激动&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;瞳孔骤然收缩，呼吸急促，手指紧紧攥住手机边缘&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手指慢慢收紧，攥住手机&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;紧张&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手指逐渐用力，指节开始发白&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;身体猛然僵直&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;震惊&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;呼吸急促，手指紧紧攥住手机边缘，整个人如遭电击&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手机从颤抖的手中滑落&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;震惊&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;身体前倾，双手撑住茶几边缘，肩膀剧烈抖动&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;裹在身上的毛毯慢慢滑落&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;崩溃&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;露出攥得发白的指节，肩膀剧烈抖动&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;转头看向窗外的大雨&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;沉思+不安&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;目光透过窗户，神情更加复杂&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;characters&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;appearance&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">32</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;gender&quot;</span><span class="punctuation">:</span> <span class="string">&quot;女&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;clothing&quot;</span><span class="punctuation">:</span> <span class="string">&quot;宽松的米色针织毛衣和深灰色休闲长裤，外披一条褪色旧羊毛毯，边缘已有轻微起球&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;hair&quot;</span><span class="punctuation">:</span> <span class="string">&quot;齐肩黑发略显凌乱，几缕发丝被室内暖光映出暗棕色，垂落在脸颊旁，一缕贴在唇边&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;base_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;眼下有明显黑眼圈，肤色偏白近乎透明，鼻梁细挺，嘴唇干燥微裂，神情疲惫却仍存清秀轮廓，眼神深处藏有多年未散的忧郁&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_time&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_time&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;duration&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;chinese_description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;深夜23:30，城市老式公寓的客厅被暴雨笼罩，窗外雨幕密集如织，闪电不时划破夜空，雷声低沉回荡。室内昏暗，唯一的光源来自一台老式电视，正静音播放着黑白电影，闪烁的微光在林然的脸上投下跳动的阴影。茶几上摊开着一本泛黄的相册，照片中是多年前的全家福，边缘微微卷起；旁边是一杯未喝完的凉茶，杯壁凝结着细密水珠，映出冷冽的光泽。林然裹着一条米色羊毛毛毯，蜷坐在沙发中央，起初神情平静，目光直视前方，但突然手机在茶几上震动，屏幕亮起刺眼的白光。他猛然警觉，身体一僵，迅速伸手抓起手机，贴在耳边，眼神紧绷，呼吸微滞，整个空间瞬间被无形的紧张填满。镜头稳定聚焦在他半明半暗的脸庞，营造出强烈的心理压迫感。&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;ai_prompt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A realistic cinematic scene in a dimly lit, old urban apartment living room at 23:30 during a heavy rainstorm. Thunder rumbles in the distance as rain pours relentlessly outside the window, creating blurred reflections of streetlights on wet pavement. Inside, a vintage television plays a black-and-white silent film with flickering light casting dynamic shadows across the room. On a wooden coffee table, an open yellowed photo album displays a faded family portrait; beside it, a half-empty glass of cooled tea beads with condensation. Lin Ran, a man in his early 30s with short dark hair and tired eyes, begins standing center frame, alert, wearing a beige wool blanket wrapped loosely around his shoulders. He slowly sits onto the couch into a curled position as his phone vibrates suddenly on the table. He reacts with sharp awareness, picks up the phone, and presses it to his ear. Medium shot, eye-level angle, static camera. Soft ambient lighting with contrast between cool blue exterior rain glow and warm TV flicker. Emphasis on facial tension, subtle movement, and atmospheric depth.&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;深夜23:30，城市老式公寓的客厅被暴雨笼罩，窗外雨幕密集如织，闪电不时划破夜空，雷声低沉回荡。室内昏暗，唯一的光源来自一台老式电视，正静音播放着黑白电影，闪烁的微光在林然的脸上投下跳动的阴影。茶几上摊开着一本泛黄的相册，照片中是多年前的全家福，边缘微微卷起；旁边是一杯未喝完的凉茶，杯壁凝结着细密水珠，映出冷冽的光泽。林然裹着一条米色羊毛毛毯，蜷坐在沙发中央，起初神情平静，目光直视前方，但突然手机在茶几上震动，屏幕亮起刺眼的白光。他猛然警觉，身体一僵，迅速伸手抓起手机，贴在耳边，眼神紧绷，呼吸微滞，整个空间瞬间被无形的紧张填满。镜头稳定聚焦在他半明半暗的脸庞，营造出强烈的心理压迫感。&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;prompt_en&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A realistic cinematic scene in a dimly lit, old urban apartment living room at 23:30 during a heavy rainstorm. Thunder rumbles in the distance as rain pours relentlessly outside the window, creating blurred reflections of streetlights on wet pavement. Inside, a vintage television plays a black-and-white silent film with flickering light casting dynamic shadows across the room. On a wooden coffee table, an open yellowed photo album displays a faded family portrait; beside it, a half-empty glass of cooled tea beads with condensation. Lin Ran, a man in his early 30s with short dark hair and tired eyes, begins standing center frame, alert, wearing a beige wool blanket wrapped loosely around his shoulders. He slowly sits onto the couch into a curled position as his phone vibrates suddenly on the table. He reacts with sharp awareness, picks up the phone, and presses it to his ear. Medium shot, eye-level angle, static camera. Soft ambient lighting with contrast between cool blue exterior rain glow and warm TV flicker. Emphasis on facial tension, subtle movement, and atmospheric depth.&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;camera&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;shot_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;medium_shot&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;angle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eye-level&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;movement&quot;</span><span class="punctuation">:</span> <span class="string">&quot;static&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;camera_angle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;medium_shot&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;characters_in_frame&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;林然&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;characters&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;林然&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;dialogue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;initial_state&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;character_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;pose&quot;</span><span class="punctuation">:</span> <span class="string">&quot;standing&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center of frame&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;holding&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nothing&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;警觉&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;appearance&quot;</span><span class="punctuation">:</span> <span class="string">&quot;男性，三十岁左右，黑色短发，面容疲惫，身披米色羊毛毛毯&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;final_state&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;character_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;pose&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sitting&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center of frame&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;gaze_direction&quot;</span><span class="punctuation">:</span> <span class="string">&quot;forward, slightly downward&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;警觉&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;holding&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手机贴在耳边&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;continuity_anchor&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;character_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;pose&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sitting&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center of frame&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;gaze_direction&quot;</span><span class="punctuation">:</span> <span class="string">&quot;forward, slightly downward&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;警觉&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;holding&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手机贴在耳边&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;continuity_anchors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;final_continuity_state&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;shot_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;time_range_sec&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">        <span class="number">10</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;scene_context&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span> <span class="string">&quot;城市老式公寓的客厅&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;深夜23:30，暴雨倾盆，雷声低鸣&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;atmosphere&quot;</span><span class="punctuation">:</span> <span class="string">&quot;安静、紧张，电视静音播放一部黑白老电影，画面闪烁微光；窗外雨幕如织，灯光在湿漉漉的地面上晕染成片；茶几上摊开一本泛黄的相册，照片中是多年前的合影，旁边是一杯未喝完的凉茶，杯壁凝着水珠&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;actions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;裹着毛毯蜷坐在沙发上&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;平静&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;身体放松，靠在沙发背上，目光柔和，双手轻轻裹紧毛毯&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手机震动&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;警觉&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;目光转向手机，身体微微前倾，手指轻触沙发扶手&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;接起电话，将手机贴在耳边&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;警觉&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手指微微颤抖，耳朵贴近手机，呼吸变得轻缓&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;电话那头传来：&#x27;是我&#x27;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;震惊&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;身体瞬间僵直，手指关节因握力过猛而泛白，呼吸凝滞&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;轻声问：&#x27;陈默？&#x27;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;试探+紧张&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手指收紧，声音轻微颤抖，身体微微前倾&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;听到对方说：&#x27;我回来了&#x27;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;震惊+激动&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;瞳孔骤然收缩，呼吸急促，手指紧紧攥住手机边缘&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手指慢慢收紧，攥住手机&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;紧张&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手指逐渐用力，指节开始发白&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;身体猛然僵直&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;震惊&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;呼吸急促，手指紧紧攥住手机边缘，整个人如遭电击&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手机从颤抖的手中滑落&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;震惊&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;身体前倾，双手撑住茶几边缘，肩膀剧烈抖动&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;裹在身上的毛毯慢慢滑落&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;崩溃&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;露出攥得发白的指节，肩膀剧烈抖动&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;转头看向窗外的大雨&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;沉思+不安&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;目光透过窗户，神情更加复杂&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;characters&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;appearance&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">32</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;gender&quot;</span><span class="punctuation">:</span> <span class="string">&quot;女&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;clothing&quot;</span><span class="punctuation">:</span> <span class="string">&quot;宽松的米色针织毛衣和深灰色休闲长裤，外披一条褪色旧羊毛毯，边缘已有轻微起球&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;hair&quot;</span><span class="punctuation">:</span> <span class="string">&quot;齐肩黑发略显凌乱，几缕发丝被室内暖光映出暗棕色，垂落在脸颊旁，一缕贴在唇边&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;base_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;眼下有明显黑眼圈，肤色偏白近乎透明，鼻梁细挺，嘴唇干燥微裂，神情疲惫却仍存清秀轮廓，眼神深处藏有多年未散的忧郁&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_time&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_time&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;duration&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;chinese_description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;深夜23:30，城市老式公寓的客厅被暴雨笼罩，窗外雨幕如织，闪电偶尔划破夜空，映出室内斑驳的光影。电视静音播放着一部黑白老电影，画面闪烁不定，微光在林然凝重的脸上跳动。茶几上摊开一本泛黄的相册，照片中是多年前他与陈默的合影，旁边是一杯未喝完的凉茶，杯壁凝结着细密水珠，仿佛时间停滞。林然坐在沙发中央，手机紧贴耳边，神情震惊而激动，目光微微低垂，盯着茶几上的旧照。电话那头传来熟悉的声音：‘是我’，他的呼吸骤然一滞；他颤抖着轻声回应：‘陈默？’声音几乎被雨声吞没。就在此时，对方说出‘我回来了’，林然的手指猛然收紧，眼中闪过难以置信的光芒，情绪从震惊转为剧烈波动的激动，整个空间仿佛因这句话而震颤。&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;ai_prompt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A realistic medium shot at eye level, capturing Lin Ran sitting on an old sofa in the center of a dimly lit living room in a vintage urban apartment. Rain pours heavily outside the window, creating a blurred curtain of water; faint city lights reflect on the wet ground, casting soft glows. A black-and-white classic film plays silently on an old television, its flickering light dancing across the walls and Lin&#x27;s face. On the coffee table, a yellowed photo album lies open, showing a nostalgic group photo from years ago; beside it, a half-drunk glass of cooled tea beads with condensation. Lin holds a phone tightly to his ear, his posture tense, eyes wide with shock and rising emotion. The camera is static, emphasizing the stillness of the scene against internal turmoil. Soft ambient lighting mixed with TV flicker creates high contrast and deep shadows. Sound design includes distant thunder, steady rain, and muffled silence from the TV. The moment unfolds in real-time over 5 seconds: initial shock upon hearing &#x27;It&#x27;s me,&#x27; cautious whisper asking &#x27;Chen Mo?,&#x27; then intense emotional surge when &#x27;I&#x27;m back&#x27; is spoken.&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;深夜23:30，城市老式公寓的客厅被暴雨笼罩，窗外雨幕如织，闪电偶尔划破夜空，映出室内斑驳的光影。电视静音播放着一部黑白老电影，画面闪烁不定，微光在林然凝重的脸上跳动。茶几上摊开一本泛黄的相册，照片中是多年前他与陈默的合影，旁边是一杯未喝完的凉茶，杯壁凝结着细密水珠，仿佛时间停滞。林然坐在沙发中央，手机紧贴耳边，神情震惊而激动，目光微微低垂，盯着茶几上的旧照。电话那头传来熟悉的声音：‘是我’，他的呼吸骤然一滞；他颤抖着轻声回应：‘陈默？’声音几乎被雨声吞没。就在此时，对方说出‘我回来了’，林然的手指猛然收紧，眼中闪过难以置信的光芒，情绪从震惊转为剧烈波动的激动，整个空间仿佛因这句话而震颤。&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;prompt_en&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A realistic medium shot at eye level, capturing Lin Ran sitting on an old sofa in the center of a dimly lit living room in a vintage urban apartment. Rain pours heavily outside the window, creating a blurred curtain of water; faint city lights reflect on the wet ground, casting soft glows. A black-and-white classic film plays silently on an old television, its flickering light dancing across the walls and Lin&#x27;s face. On the coffee table, a yellowed photo album lies open, showing a nostalgic group photo from years ago; beside it, a half-drunk glass of cooled tea beads with condensation. Lin holds a phone tightly to his ear, his posture tense, eyes wide with shock and rising emotion. The camera is static, emphasizing the stillness of the scene against internal turmoil. Soft ambient lighting mixed with TV flicker creates high contrast and deep shadows. Sound design includes distant thunder, steady rain, and muffled silence from the TV. The moment unfolds in real-time over 5 seconds: initial shock upon hearing &#x27;It&#x27;s me,&#x27; cautious whisper asking &#x27;Chen Mo?,&#x27; then intense emotional surge when &#x27;I&#x27;m back&#x27; is spoken.&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;camera&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;shot_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;medium_shot&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;angle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eye-level&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;movement&quot;</span><span class="punctuation">:</span> <span class="string">&quot;static&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;camera_angle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;medium_shot&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;characters_in_frame&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;林然&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;characters&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;林然&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;dialogue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;initial_state&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;character_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;pose&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sitting&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center of frame&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;holding&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手机贴在耳边&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;震惊+激动&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;appearance&quot;</span><span class="punctuation">:</span> <span class="string">&quot;三十多岁男性，穿着旧款灰色毛衣，头发微乱，眼神深邃且充满紧张感，面部轮廓被电视微光勾勒&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;final_state&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;character_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;pose&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sitting&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center of frame&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;gaze_direction&quot;</span><span class="punctuation">:</span> <span class="string">&quot;forward, slightly downward&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;震惊+激动&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;holding&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手机贴在耳边&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;continuity_anchor&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;character_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;pose&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sitting&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center of frame&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;gaze_direction&quot;</span><span class="punctuation">:</span> <span class="string">&quot;forward, slightly downward&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;震惊+激动&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;holding&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手机贴在耳边&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;continuity_anchors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;final_continuity_state&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;shot_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;time_range_sec&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">        <span class="number">15</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;scene_context&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span> <span class="string">&quot;城市老式公寓的客厅&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;深夜23:30，暴雨倾盆，雷声低鸣&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;atmosphere&quot;</span><span class="punctuation">:</span> <span class="string">&quot;安静、紧张，电视静音播放一部黑白老电影，画面闪烁微光；窗外雨幕如织，灯光在湿漉漉的地面上晕染成片；茶几上摊开一本泛黄的相册，照片中是多年前的合影，旁边是一杯未喝完的凉茶，杯壁凝着水珠&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;actions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;裹着毛毯蜷坐在沙发上&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;平静&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;身体放松，靠在沙发背上，目光柔和，双手轻轻裹紧毛毯&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手机震动&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;警觉&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;目光转向手机，身体微微前倾，手指轻触沙发扶手&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;接起电话，将手机贴在耳边&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;警觉&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手指微微颤抖，耳朵贴近手机，呼吸变得轻缓&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;电话那头传来：&#x27;是我&#x27;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;震惊&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;身体瞬间僵直，手指关节因握力过猛而泛白，呼吸凝滞&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;轻声问：&#x27;陈默？&#x27;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;试探+紧张&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手指收紧，声音轻微颤抖，身体微微前倾&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;听到对方说：&#x27;我回来了&#x27;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;震惊+激动&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;瞳孔骤然收缩，呼吸急促，手指紧紧攥住手机边缘&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手指慢慢收紧，攥住手机&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;紧张&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手指逐渐用力，指节开始发白&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;身体猛然僵直&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;震惊&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;呼吸急促，手指紧紧攥住手机边缘，整个人如遭电击&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手机从颤抖的手中滑落&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;震惊&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;身体前倾，双手撑住茶几边缘，肩膀剧烈抖动&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;裹在身上的毛毯慢慢滑落&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;崩溃&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;露出攥得发白的指节，肩膀剧烈抖动&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;转头看向窗外的大雨&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;沉思+不安&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;目光透过窗户，神情更加复杂&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;characters&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">          <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;appearance&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">32</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;gender&quot;</span><span class="punctuation">:</span> <span class="string">&quot;女&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;clothing&quot;</span><span class="punctuation">:</span> <span class="string">&quot;宽松的米色针织毛衣和深灰色休闲长裤，外披一条褪色旧羊毛毯，边缘已有轻微起球&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;hair&quot;</span><span class="punctuation">:</span> <span class="string">&quot;齐肩黑发略显凌乱，几缕发丝被室内暖光映出暗棕色，垂落在脸颊旁，一缕贴在唇边&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;base_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;眼下有明显黑眼圈，肤色偏白近乎透明，鼻梁细挺，嘴唇干燥微裂，神情疲惫却仍存清秀轮廓，眼神深处藏有多年未散的忧郁&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_time&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_time&quot;</span><span class="punctuation">:</span> <span class="number">15</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;duration&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;chinese_description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;深夜23:30，暴雨如注，城市老式公寓的客厅被窗外零星的霓虹与电视闪烁的黑白光影交织照亮。林然坐在沙发中央，身体微微前倾，手机紧贴耳边，神情凝重而震惊。电视静音播放着一部老电影，画面忽明忽暗，映照在他轮廓分明的脸上，透出一丝不安。茶几上摊开一本泛黄的相册，照片中是多年前一家人的合影，边缘卷曲，仿佛承载着沉重回忆。一杯凉茶搁在一旁，杯壁凝结着细密水珠，倒映着窗外模糊的雨景。突然，他手指缓缓收紧，指节发白，攥住手机，呼吸微滞；紧接着，身体猛然僵直，肩膀绷紧，脊背挺得笔直，仿佛接到某个颠覆性的消息。整个空间安静得只剩雨打玻璃的轻响和低沉雷鸣，气氛紧张到极点，仿佛时间在这一刻凝固。&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;ai_prompt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A realistic medium shot, eye-level angle, static camera, capturing a tense scene in a dimly lit old apartment living room at 23:30 during a heavy rainstorm. The window is streaked with rain, reflecting blurred city lights that pool on the wet floor. A black-and-white classic film plays silently on an old CRT television, its flickering glow casting shifting shadows across the room. LIN RAN, a man in his late 30s with short dark hair and wearing a wrinkled white shirt, sits centered on a worn fabric sofa, holding a smartphone to his ear. He begins in a seated pose, gaze slightly downward, face illuminated intermittently by the TV’s pale light, expression stunned. Slowly, his fingers tighten around the phone—knuckles whitening—then his entire body stiffens abruptly, spine straightening, shoulders tensing. A glass of cold tea sweats on the coffee table beside an open, yellowed photo album showing a vintage family portrait. Cinematic lighting with high contrast, cool tones, subtle reflections on wet surfaces, and atmospheric depth. Sound design implies distant thunder and muffled rain.&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;深夜23:30，暴雨如注，城市老式公寓的客厅被窗外零星的霓虹与电视闪烁的黑白光影交织照亮。林然坐在沙发中央，身体微微前倾，手机紧贴耳边，神情凝重而震惊。电视静音播放着一部老电影，画面忽明忽暗，映照在他轮廓分明的脸上，透出一丝不安。茶几上摊开一本泛黄的相册，照片中是多年前一家人的合影，边缘卷曲，仿佛承载着沉重回忆。一杯凉茶搁在一旁，杯壁凝结着细密水珠，倒映着窗外模糊的雨景。突然，他手指缓缓收紧，指节发白，攥住手机，呼吸微滞；紧接着，身体猛然僵直，肩膀绷紧，脊背挺得笔直，仿佛接到某个颠覆性的消息。整个空间安静得只剩雨打玻璃的轻响和低沉雷鸣，气氛紧张到极点，仿佛时间在这一刻凝固。&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;prompt_en&quot;</span><span class="punctuation">:</span> <span class="string">&quot;A realistic medium shot, eye-level angle, static camera, capturing a tense scene in a dimly lit old apartment living room at 23:30 during a heavy rainstorm. The window is streaked with rain, reflecting blurred city lights that pool on the wet floor. A black-and-white classic film plays silently on an old CRT television, its flickering glow casting shifting shadows across the room. LIN RAN, a man in his late 30s with short dark hair and wearing a wrinkled white shirt, sits centered on a worn fabric sofa, holding a smartphone to his ear. He begins in a seated pose, gaze slightly downward, face illuminated intermittently by the TV’s pale light, expression stunned. Slowly, his fingers tighten around the phone—knuckles whitening—then his entire body stiffens abruptly, spine straightening, shoulders tensing. A glass of cold tea sweats on the coffee table beside an open, yellowed photo album showing a vintage family portrait. Cinematic lighting with high contrast, cool tones, subtle reflections on wet surfaces, and atmospheric depth. Sound design implies distant thunder and muffled rain.&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;camera&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;shot_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;medium_shot&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;angle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eye-level&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;movement&quot;</span><span class="punctuation">:</span> <span class="string">&quot;static&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;camera_angle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;medium_shot&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;characters_in_frame&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;林然&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;characters&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;林然&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;dialogue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;initial_state&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;character_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;pose&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sitting&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center of frame&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;holding&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手机贴在耳边&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;震惊&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;appearance&quot;</span><span class="punctuation">:</span> <span class="string">&quot;男性，三十多岁，短发微乱，身穿皱褶的白色衬衫，面容疲惫，眼下有阴影，皮肤略显苍白&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;final_state&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;character_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;pose&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sitting, body rigid&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center of frame&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;gaze_direction&quot;</span><span class="punctuation">:</span> <span class="string">&quot;forward, slightly downward&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;震惊&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;holding&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手机紧握于耳边，手指收紧&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;continuity_anchor&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;character_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;pose&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sitting, body rigid&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center of frame&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;gaze_direction&quot;</span><span class="punctuation">:</span> <span class="string">&quot;forward, slightly downward&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;震惊&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;holding&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手机紧握于耳边，手指收紧&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;continuity_anchors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;final_continuity_state&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;final_continuity_state&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;林然&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;character_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;pose&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sitting, body rigid&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="string">&quot;center of frame&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;gaze_direction&quot;</span><span class="punctuation">:</span> <span class="string">&quot;forward, slightly downward&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;震惊&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;holding&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手机紧握于耳边，手指收紧&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;metadata&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;generated_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-10-28T22:57:42.332023Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;llm_model&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rule_based&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;continuity_verified&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;saved_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-10-28T22:57:42.333060&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;uuid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hengline-20251028-223110&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="集成方式">集成方式</h3>
<p>集成到Web应用（API）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Flask示例</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify</span><br><span class="line"><span class="keyword">from</span> hengline.generate_agent <span class="keyword">import</span> generate_storyboard</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/generate&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate</span>():</span><br><span class="line">    data = request.json</span><br><span class="line">    result = generate_storyboard(</span><br><span class="line">        script_text=data[<span class="string">&#x27;script_text&#x27;</span>],</span><br><span class="line">        style=data.get(<span class="string">&#x27;style&#x27;</span>, <span class="string">&#x27;realistic&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> jsonify(result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>集成到 LangGraph 工作流节点</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langgraph.graph <span class="keyword">import</span> StateGraph, END</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义全局状态</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StoryboardState</span>(<span class="title class_ inherited__">TypedDict</span>):</span><br><span class="line">    raw_script: <span class="built_in">str</span></span><br><span class="line">    style: <span class="built_in">str</span></span><br><span class="line">    storyboard: <span class="built_in">list</span></span><br><span class="line">    continuity_state: <span class="built_in">dict</span></span><br><span class="line">    error: <span class="type">Optional</span>[<span class="built_in">str</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分镜生成节点</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">storyboard_agent_node</span>(<span class="params">state: StoryboardState</span>) -&gt; <span class="built_in">dict</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = generate_storyboard(</span><br><span class="line">            script_text=state[<span class="string">&quot;raw_script&quot;</span>],</span><br><span class="line">            style=state[<span class="string">&quot;style&quot;</span>],</span><br><span class="line">            prev_continuity_state=state.get(<span class="string">&quot;continuity_state&quot;</span>)</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;storyboard&quot;</span>: result[<span class="string">&quot;shots&quot;</span>],</span><br><span class="line">            <span class="string">&quot;continuity_state&quot;</span>: result[<span class="string">&quot;final_continuity_state&quot;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>: <span class="built_in">str</span>(e)&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建图</span></span><br><span class="line">workflow = StateGraph(StoryboardState)</span><br><span class="line">workflow.add_node(<span class="string">&quot;generate_storyboard&quot;</span>, storyboard_agent_node)</span><br><span class="line">workflow.set_entry_point(<span class="string">&quot;generate_storyboard&quot;</span>)</span><br><span class="line">workflow.add_edge(<span class="string">&quot;generate_storyboard&quot;</span>, END)</span><br><span class="line"></span><br><span class="line">app = workflow.<span class="built_in">compile</span>()</span><br></pre></td></tr></table></figure>
<p>集成到A2A系统</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># A2A Agent示例</span></span><br><span class="line"><span class="keyword">from</span> a2a <span class="keyword">import</span> Agent, Message</span><br><span class="line"><span class="keyword">from</span> hengline.generate_agent <span class="keyword">import</span> generate_storyboard</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StoryboardAgent</span>(<span class="title class_ inherited__">Agent</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_message</span>(<span class="params">self, message: Message</span>) -&gt; Message:</span><br><span class="line">        <span class="comment"># 处理传入的剧本消息</span></span><br><span class="line">        script = message.content</span><br><span class="line">        storyboard = generate_storyboard(script)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 返回分镜结果</span></span><br><span class="line">        <span class="keyword">return</span> Message(</span><br><span class="line">            content=storyboard,</span><br><span class="line">            <span class="built_in">type</span>=<span class="string">&quot;storyboard_result&quot;</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注册和使用Agent</span></span><br><span class="line">agent = StoryboardAgent(name=<span class="string">&quot;storyboard_agent&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="技术架构（多智能体）">技术架构（多智能体）</h2>
<p><img src= "/img/20241215205335173426721579192.webp" data-lazy-src="/imgs/ai/image-20251027171255745.webp" alt="image-20251027171255745"></p>
<p><strong>智能体框架</strong>: LangGraph（专为多智能体状态机设计）</p>
<table>
<thead>
<tr>
<th>智能体名称</th>
<th>职责</th>
<th>技术栈</th>
<th>输入 → 输出</th>
</tr>
</thead>
<tbody>
<tr>
<td>1. 剧本解析智能体（Script Parser Agent）</td>
<td>解析原始剧本，提取结构化元素（场景、角色、动作、对话、情绪）</td>
<td>LlamaIndex + 规则引擎</td>
<td>原始文本 → 结构化剧本对象（JSON）</td>
</tr>
<tr>
<td>2. 时序规划智能体（Temporal Planner Agent）</td>
<td>将剧本按 5 秒粒度切分，估算每段动作/对话时长，避免超时</td>
<td>规则库 + LLM（微调动作时长模型）</td>
<td>结构化剧本 → 带时间戳的分段计划</td>
</tr>
<tr>
<td>3. 连续性守护智能体（Continuity Guardian Agent）</td>
<td>跟踪角色状态（位置、姿势、情绪、道具），生成/验证连续性锚点</td>
<td>向量记忆 + 状态机</td>
<td>上一段状态 + 当前动作 → 连续性约束</td>
</tr>
<tr>
<td>4. 分镜生成智能体（Shot Generator Agent）</td>
<td>生成符合 AI 视频模型要求的提示词（含镜头、光线、构图）</td>
<td>LangChain + LLM（GPT-4o/Claude）</td>
<td>分段内容 + 连续性锚点 → AI Prompt</td>
</tr>
<tr>
<td>5. 质量审查智能体（QA Agent）</td>
<td>检查分镜是否连贯、是否超时、角色是否漂移</td>
<td>规则检查 + LLM 自反思</td>
<td>分镜序列 → 修正建议或通过</td>
</tr>
</tbody>
</table>
<p><strong>输入示例</strong>：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;script_text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;深夜11点，城市公寓内，窗外下着大雨。林然裹着毯子坐在沙发上，电视静音播放着老电影。手机突然震动，屏幕亮起“未知号码”。她犹豫了一下，还是接了起来。电话那头沉默了几秒，传来一个熟悉又陌生的男声：“是我。”林然的手微微发抖，轻声问：“……陈默？你还好吗？”对方停顿片刻，低声说：“我回来了。”&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;style&quot;</span><span class="punctuation">:</span> <span class="string">&quot;realistic&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="剧本解析智能体">剧本解析智能体</h3>
<p>将整段中文剧本 → 结构化动作序列</p>
<blockquote>
<ul class="lvl-1">
<li class="lvl-2">
<p>LlamaIndex + 规则增强的 LLM</p>
</li>
<li class="lvl-2">
<p>中文分词（jieba）+ 正则匹配</p>
</li>
<li class="lvl-2">
<p>自动识别场景、角色、动作、对话、情绪</p>
</li>
<li class="lvl-2">
<p>推断角色外观（若未提供）</p>
</li>
</ul>
</blockquote>
<p><strong>解析规则应包含</strong>：</p>
<ol>
<li class="lvl-3">
<p>动作切分规则：</p>
<ul class="lvl-2">
<li class="lvl-5">遇到句号/分号/连接词（“突然”“随后”） → 拆分动作</li>
<li class="lvl-5">对话独立为 <code>dialogue</code> 字段</li>
</ul>
</li>
<li class="lvl-3">
<p>角色行为去重：</p>
<ul class="lvl-2">
<li class="lvl-5">未出镜角色（如电话声音）不生成独立 action</li>
</ul>
</li>
<li class="lvl-3">
<p>情绪标准化：</p>
<ul class="lvl-2">
<li class="lvl-5">
<p>将文学描述映射到预定义情绪库：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">EMOTION_MAP = &#123;</span><br><span class="line">    <span class="string">&quot;恐惧中夹杂震惊&quot;</span>: [<span class="string">&quot;震惊&quot;</span>, <span class="string">&quot;恐惧&quot;</span>],</span><br><span class="line">    <span class="string">&quot;低沉压抑&quot;</span>: [<span class="string">&quot;压抑&quot;</span>, <span class="string">&quot;愧疚&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<p><strong>输出示例</strong>：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scenes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span> <span class="string">&quot;城市老式公寓的客厅&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;深夜23:30，暴雨倾盆，雷声低鸣&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;atmosphere&quot;</span><span class="punctuation">:</span> <span class="string">&quot;安静、紧张，电视静音播放一部黑白老电影，画面闪烁微光；窗外雨幕如织，灯光在湿漉漉的地面上晕染成片；茶几上摊开一本泛黄的相册，照片中是多年前的合影，旁边是一杯未喝完的凉茶，杯壁凝着水珠&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;actions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;裹着毛毯蜷坐在沙发上&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;平静&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;身体放松，靠在沙发背上，目光柔和，双手轻轻裹紧毛毯&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手机震动&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;警觉&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;目光转向手机，身体微微前倾，手指轻触沙发扶手&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;接起电话，将手机贴在耳边&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;警觉&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手指微微颤抖，耳朵贴近手机，呼吸变得轻缓&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;电话那头传来：&#x27;是我&#x27;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;震惊&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;身体瞬间僵直，手指关节因握力过猛而泛白，呼吸凝滞&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;轻声问：&#x27;陈默？&#x27;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;试探+紧张&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手指收紧，声音轻微颤抖，身体微微前倾&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;听到对方说：&#x27;我回来了&#x27;&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;震惊+激动&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;瞳孔骤然收缩，呼吸急促，手指紧紧攥住手机边缘&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手指慢慢收紧，攥住手机&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;紧张&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手指逐渐用力，指节开始发白&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;身体猛然僵直&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;震惊&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;呼吸急促，手指紧紧攥住手机边缘，整个人如遭电击&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;手机从颤抖的手中滑落&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;震惊&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;身体前倾，双手撑住茶几边缘，肩膀剧烈抖动&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;裹在身上的毛毯慢慢滑落&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;崩溃&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;露出攥得发白的指节，肩膀剧烈抖动&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;character&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;转头看向窗外的大雨&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;emotion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;沉思+不安&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;state_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;目光透过窗户，神情更加复杂&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;characters&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;林然&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;appearance&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">32</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;gender&quot;</span><span class="punctuation">:</span> <span class="string">&quot;女&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;clothing&quot;</span><span class="punctuation">:</span> <span class="string">&quot;宽松的米色针织毛衣和深灰色休闲长裤，外披一条褪色旧羊毛毯，边缘已有轻微起球&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;hair&quot;</span><span class="punctuation">:</span> <span class="string">&quot;齐肩黑发略显凌乱，几缕发丝被室内暖光映出暗棕色，垂落在脸颊旁，一缕贴在唇边&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;base_features&quot;</span><span class="punctuation">:</span> <span class="string">&quot;眼下有明显黑眼圈，肤色偏白近乎透明，鼻梁细挺，嘴唇干燥微裂，神情疲惫却仍存清秀轮廓，眼神深处藏有多年未散的忧郁&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;metadata&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;saved_at&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-10-28T22:55:49.598432&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;uuid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hengline-20251028-223110&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="时序规划智能体">时序规划智能体</h3>
<p>将<strong>结构化的原子动作序列</strong> → 拆分为 <strong>N 个 5 秒分镜段（segments）</strong>，确保：</p>
<ol>
<li class="lvl-3">
<p><strong>每段总时长 ≤ 5.5 秒</strong>（留 0.5 秒缓冲防超时）</p>
</li>
<li class="lvl-3">
<p><strong>语义完整性</strong>：不拆分单句对话、连续动作</p>
</li>
<li class="lvl-3">
<p><strong>输出可执行</strong>：每段包含动作列表 + 精确时长估算</p>
</li>
</ol>
<p><strong>内部处理流程</strong>：</p>
<p>步骤 1：初始化</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>加载 <strong>动作时长估算器</strong>（含动词库 + 对话模型）</p>
</li>
<li class="lvl-2">
<p>设置 <strong>最大分段时长 = 5.5 秒</strong></p>
</li>
</ul>
<p>步骤 2：贪心分段（核心算法）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">segments = []</span><br><span class="line">current_segment = []</span><br><span class="line">current_time = <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> action <span class="keyword">in</span> actions:</span><br><span class="line">    <span class="comment"># 估算当前动作时长</span></span><br><span class="line">    duration = duration_estimator.estimate(</span><br><span class="line">        action_text=action[<span class="string">&quot;action&quot;</span>] <span class="keyword">or</span> action[<span class="string">&quot;dialogue&quot;</span>],</span><br><span class="line">        emotion=action[<span class="string">&quot;emotion&quot;</span>],</span><br><span class="line">        character_type=get_character_type(action[<span class="string">&quot;character&quot;</span>])</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检查是否可加入当前段</span></span><br><span class="line">    <span class="keyword">if</span> current_time + duration &lt;= <span class="number">5.5</span>:</span><br><span class="line">        current_segment.append(action)</span><br><span class="line">        current_time += duration</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 提交当前段</span></span><br><span class="line">        segments.append(create_segment(current_segment, current_time))</span><br><span class="line">        <span class="comment"># 开启新段（当前动作放入新段）</span></span><br><span class="line">        current_segment = [action]</span><br><span class="line">        current_time = duration</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交最后一段</span></span><br><span class="line"><span class="keyword">if</span> current_segment:</span><br><span class="line">    segments.append(create_segment(current_segment, current_time))</span><br></pre></td></tr></table></figure>
<p>步骤 3：语义完整性保护（关键规则）</p>
<p>在贪心算法前预标记 <strong>不可分割单元（atomic units）</strong></p>
<table>
<thead>
<tr>
<th>场景</th>
<th>处理方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>单句对话</td>
<td>强制整句放入一段（即使超 5.5 秒）</td>
</tr>
<tr>
<td>连续动作</td>
<td>如“起身→走向门口”，尽量同段</td>
</tr>
<tr>
<td>情绪突变</td>
<td>如“平静→震惊”，优先分段</td>
</tr>
</tbody>
</table>
<p><strong>注意事项</strong></p>
<blockquote>
<ol>
<li class="lvl-3">
<p><strong>缓冲区管理</strong></p>
<ul class="lvl-3">
<li class="lvl-5">
<p>目标时长：5.0 秒</p>
</li>
<li class="lvl-5">
<p>允许上限：5.5 秒（防动作截断）</p>
</li>
<li class="lvl-5">
<p><strong>绝不允许 &lt; 0.4 秒</strong>（防空镜头）</p>
</li>
</ul>
</li>
<li class="lvl-3">
<p><strong>长动作处理</strong></p>
<ul class="lvl-3">
<li class="lvl-5">若单动作 &gt; 5.5 秒（如“奔跑穿过街道”）：
<ul class="lvl-5">
<li class="lvl-7">自动拆分为 <strong>起始 + 中间 + 结束</strong> 三段</li>
<li class="lvl-7">注入 <strong>continuity_anchor</strong> 保持连贯</li>
</ul>
</li>
</ul>
</li>
<li class="lvl-3">
<p><strong>情绪时长补偿</strong></p>
<ul class="lvl-3">
<li class="lvl-5">
<p>高强度情绪（如“崩溃大哭”）自动 +0.5 秒</p>
</li>
<li class="lvl-5">
<p>低强度情绪（如“平静注视”）自动 -0.3 秒</p>
</li>
</ul>
</li>
</ol>
</blockquote>
<p>输出示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;segments&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;segment_id&quot;</span>: <span class="string">&quot;seg_01&quot;</span>,</span><br><span class="line">      <span class="string">&quot;time_range_sec&quot;</span>: [<span class="number">0</span>, <span class="number">4.8</span>],</span><br><span class="line">      <span class="string">&quot;duration_sec&quot;</span>: <span class="number">4.8</span>,</span><br><span class="line">      <span class="string">&quot;actions&quot;</span>: [</span><br><span class="line">        &#123;<span class="string">&quot;character&quot;</span>: <span class="string">&quot;林然&quot;</span>, <span class="string">&quot;action&quot;</span>: <span class="string">&quot;裹着毯子坐在沙发上&quot;</span>, <span class="string">&quot;emotion&quot;</span>: <span class="string">&quot;疲惫&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;character&quot;</span>: <span class="string">&quot;林然&quot;</span>, <span class="string">&quot;action&quot;</span>: <span class="string">&quot;手机突然震动&quot;</span>, <span class="string">&quot;emotion&quot;</span>: <span class="string">&quot;警觉&quot;</span>&#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;scene_context&quot;</span>: &#123; ... &#125;  // 继承自输入</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;segment_id&quot;</span>: <span class="string">&quot;seg_02&quot;</span>,</span><br><span class="line">      <span class="string">&quot;time_range_sec&quot;</span>: [<span class="number">4.8</span>, <span class="number">9.5</span>],</span><br><span class="line">      <span class="string">&quot;duration_sec&quot;</span>: <span class="number">4.7</span>,</span><br><span class="line">      <span class="string">&quot;actions&quot;</span>: [</span><br><span class="line">        &#123;<span class="string">&quot;character&quot;</span>: <span class="string">&quot;林然&quot;</span>, <span class="string">&quot;dialogue&quot;</span>: <span class="string">&quot;……陈默？你还好吗？&quot;</span>, <span class="string">&quot;emotion&quot;</span>: <span class="string">&quot;紧张&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;character&quot;</span>: <span class="string">&quot;林然&quot;</span>, <span class="string">&quot;action&quot;</span>: <span class="string">&quot;手微微发抖&quot;</span>, <span class="string">&quot;emotion&quot;</span>: <span class="string">&quot;震惊&quot;</span>&#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;scene_context&quot;</span>: &#123; ... &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;total_duration_sec&quot;</span>: <span class="number">9.5</span>,</span><br><span class="line">  <span class="string">&quot;metadata&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;planner_version&quot;</span>: <span class="string">&quot;1.2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;max_segment_duration&quot;</span>: <span class="number">5.5</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="连续性守护智能体">连续性守护智能体</h3>
<p>跟踪角色状态（位置、姿势、情绪、道具），生成/验证连续性锚点</p>
<blockquote>
<p>向量记忆 + 状态机：上一段状态 + 当前动作 → 连续性约束</p>
</blockquote>
<h3 id="分镜生成智能体">分镜生成智能体</h3>
<h3 id="质量审查智能体">质量审查智能体</h3>
<h2 id="智能体实现细节">智能体实现细节</h2>
<h3 id="场景及动作时长">场景及动作时长</h3>
<h3 id="提示工程管理">提示工程管理</h3>
<p><strong>剧本分析提示词</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;1.1&quot;</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">&quot;优化剧本解析结果，确保场景、角色和动作的正确解析&quot;</span></span><br><span class="line"><span class="attr">template:</span> <span class="string">|</span></span><br><span class="line"><span class="string">  你是一位专业的剧本分析专家，请根据以下原始解析结果，优化和完善剧本结构：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">  <span class="string">原始解析结果：&#123;raw_script&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="string">要求：</span></span><br><span class="line">  <span class="number">1</span><span class="string">.</span> <span class="string">检查场景、角色对话和动作描述的完整性和准确性</span></span><br><span class="line">  <span class="number">2</span><span class="string">.</span> <span class="string">修正任何明显的解析错误</span></span><br><span class="line">  <span class="number">3</span><span class="string">.</span> <span class="string">确保每个场景都有明确的场景名、时间和地点</span></span><br><span class="line">  <span class="number">4</span><span class="string">.</span> <span class="string">确保每个对话都有明确的角色标识</span></span><br><span class="line">  <span class="number">5</span><span class="string">.</span> <span class="string">补充缺失的动作描述和情感信息</span></span><br><span class="line"></span><br><span class="line">  <span class="string">请直接返回优化后的完整JSON结构，确保格式完全正确。</span></span><br></pre></td></tr></table></figure>
<p><strong>剧本分镜提示词</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;1.4&quot;</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">&quot;生成5秒分镜，含中文画面描述和英文AI视频提示词，优化提示词结构和输出格式&quot;</span></span><br><span class="line"><span class="attr">template:</span> <span class="string">|</span></span><br><span class="line"><span class="string">  你是一位顶尖的电影分镜师和AI视频提示词工程师，精通分镜头设计和视觉叙事。请为一段5秒的短视频生成专业分镜：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">  <span class="comment">## 场景信息</span></span><br><span class="line">  <span class="string">场景位置:</span> &#123;<span class="string">location</span>&#125;</span><br><span class="line">  <span class="string">时间:</span> &#123;<span class="string">time</span>&#125;</span><br><span class="line">  <span class="string">氛围:</span> &#123;<span class="string">atmosphere</span>&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">## 动作序列</span></span><br><span class="line">  &#123;<span class="string">actions_text</span>&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">## 连续性约束</span></span><br><span class="line">  &#123;<span class="string">continuity_constraints_text</span>&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">## 视频风格</span></span><br><span class="line">  &#123;<span class="string">style</span>&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">## 分镜ID</span></span><br><span class="line">  &#123;<span class="string">shot_id</span>&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">## 创作要求</span></span><br><span class="line">  <span class="number">1</span><span class="string">.</span> <span class="string">**精确计时**:</span> <span class="string">确保所有描述的动作能够在5秒内自然流畅地完成</span></span><br><span class="line">  <span class="number">2</span><span class="string">.</span> <span class="string">**生动描述**:</span> <span class="string">中文画面描述要具体、生动，包含场景细节、角色状态和情感变化</span></span><br><span class="line">  <span class="number">3</span><span class="string">.</span> <span class="string">**专业提示词**:</span> <span class="string">英文AI提示词必须详细精确，使用电影术语和视觉描述，适合主流AI视频生成模型</span></span><br><span class="line">  <span class="number">4</span><span class="string">.</span> <span class="string">**镜头设计**:</span> <span class="string">选择最适合呈现当前场景的镜头类型、角度和运动方式</span></span><br><span class="line">  <span class="number">5</span><span class="string">.</span> <span class="string">**连续性保证**:</span> <span class="string">严格遵循连续性约束，确保角色外观、位置和状态的一致性</span></span><br><span class="line">  <span class="number">6</span><span class="string">.</span> <span class="string">**细节丰富**:</span> <span class="string">添加适当的环境细节、光线效果和视觉元素，增强画面表现力</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">## 输出格式要求</span></span><br><span class="line">  <span class="string">请严格按照以下JSON格式输出，不要添加任何额外的解释、说明或前缀后缀：</span></span><br><span class="line">  &#123;&#123;</span><br><span class="line">    <span class="attr">&quot;chinese_description&quot;:</span> <span class="string">&quot;详细的中文画面描述，至少200字&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;ai_prompt&quot;:</span> <span class="string">&quot;详细的英文AI视频提示词，包含镜头、构图、灯光、角色和动作描述&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;camera&quot;:</span> &#123;&#123;</span><br><span class="line">      <span class="attr">&quot;shot_type&quot;:</span> <span class="string">&quot;镜头类型，如medium_shot、close_up、wide_shot等&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;angle&quot;:</span> <span class="string">&quot;拍摄角度，如eye-level、high-angle、low-angle等&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;movement&quot;:</span> <span class="string">&quot;镜头运动，如static、pan、tilt、track等&quot;</span></span><br><span class="line">    &#125;&#125;,</span><br><span class="line">    <span class="attr">&quot;initial_state&quot;:</span> [</span><br><span class="line">      &#123;&#123;</span><br><span class="line">        <span class="attr">&quot;character_name&quot;:</span> <span class="string">&quot;角色名&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;pose&quot;:</span> <span class="string">&quot;初始姿势，如standing、sitting、walking等&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;position&quot;:</span> <span class="string">&quot;初始位置，如left、center、right等&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;holding&quot;:</span> <span class="string">&quot;手持物品描述&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;emotion&quot;:</span> <span class="string">&quot;初始情绪描述&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;appearance&quot;:</span> <span class="string">&quot;角色外观详细描述&quot;</span></span><br><span class="line">      &#125;&#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;final_state&quot;:</span> [</span><br><span class="line">      &#123;&#123;</span><br><span class="line">        <span class="attr">&quot;character_name&quot;:</span> <span class="string">&quot;角色名&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;pose&quot;:</span> <span class="string">&quot;结束姿势&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;position&quot;:</span> <span class="string">&quot;结束位置&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;gaze_direction&quot;:</span> <span class="string">&quot;视线方向描述&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;emotion&quot;:</span> <span class="string">&quot;结束情绪描述&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;holding&quot;:</span> <span class="string">&quot;手持物品描述&quot;</span></span><br><span class="line">      &#125;&#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="工作流节点定义">工作流节点定义</h3>
<p>包含所有工作流执行功能</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">WorkflowNodes</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;工作流节点集合，封装所有工作流执行功能&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, script_parser, temporal_planner, continuity_guardian, shot_generator, qa_agent, llm=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        初始化工作流节点集合</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            script_parser: 剧本解析器实例</span></span><br><span class="line"><span class="string">            temporal_planner: 时序规划器实例</span></span><br><span class="line"><span class="string">            continuity_guardian: 连续性守卫实例</span></span><br><span class="line"><span class="string">            shot_generator: 分镜生成器实例</span></span><br><span class="line"><span class="string">            qa_agent: 质量审查实例</span></span><br><span class="line"><span class="string">            llm: 语言模型实例（可选）</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.script_parser = script_parser</span><br><span class="line">        <span class="variable language_">self</span>.temporal_planner = temporal_planner</span><br><span class="line">        <span class="variable language_">self</span>.continuity_guardian = continuity_guardian</span><br><span class="line">        <span class="variable language_">self</span>.shot_generator = shot_generator</span><br><span class="line">        <span class="variable language_">self</span>.qa_agent = qa_agent</span><br><span class="line">        <span class="variable language_">self</span>.llm = llm</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_script_node</span>(<span class="params">self, state: StoryboardWorkflowState</span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;解析剧本文本节点&quot;&quot;&quot;</span></span><br><span class="line">        debug(<span class="string">&quot;解析剧本文本节点执行中&quot;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">			<span class="comment"># 使用LLM增强解析</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            error(<span class="string">f&quot;剧本解析失败: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;error&quot;</span>: <span class="built_in">str</span>(e)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">plan_timeline_node</span>(<span class="params">self, state: StoryboardWorkflowState</span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;规划时间线节点&quot;&quot;&quot;</span></span><br><span class="line">        debug(<span class="string">&quot;规划时间线节点执行中&quot;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 进行时序规划</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            error(<span class="string">f&quot;时序规划失败: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;error&quot;</span>: <span class="built_in">str</span>(e)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate_shot_node</span>(<span class="params">self, state: StoryboardWorkflowState</span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        生成分镜节点</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        debug(<span class="string">f&quot;生成分镜节点执行中，当前分段索引: <span class="subst">&#123;state[<span class="string">&#x27;current_segment_index&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 获取场景上下文，增加安全检查，生成连续性约束</span></span><br><span class="line">            <span class="comment"># 生成分镜</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            error(<span class="string">f&quot;生成分镜节点发生严重错误: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;error&quot;</span>: <span class="built_in">str</span>(e)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">review_shot_node</span>(<span class="params">self, state: StoryboardWorkflowState</span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;审查分镜节点，优化警告处理&quot;&quot;&quot;</span></span><br><span class="line">        info(<span class="string">&quot;审查分镜节点执行中&quot;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 审查分镜</span></span><br><span class="line">            <span class="comment"># 记录不同级别的问题</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            error(<span class="string">f&quot;分镜审查失败: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;qa_results&quot;</span>: qa_results</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">extract_continuity_node</span>(<span class="params">self, state: StoryboardWorkflowState</span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;提取连续性信息节点&quot;&quot;&quot;</span></span><br><span class="line">        debug(<span class="string">&quot;提取连续性信息节点执行中&quot;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 如果是有效分镜，提取连续性锚点</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            error(<span class="string">f&quot;提取连续性信息失败: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;error&quot;</span>: <span class="built_in">str</span>(e)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">review_sequence_node</span>(<span class="params">self, state: StoryboardWorkflowState</span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;审查分镜序列节点，优化序列连续性审查&quot;&quot;&quot;</span></span><br><span class="line">        debug(<span class="string">&quot;审查分镜序列连续性节点执行中&quot;</span>)</span><br><span class="line">        <span class="keyword">try</span>:    </span><br><span class="line">            <span class="comment"># 分类错误类型          </span></span><br><span class="line">            <span class="comment"># 记录警告</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            error(<span class="string">f&quot;分镜序列审查失败: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="comment"># 返回默认的审查结果</span></span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;sequence_qa&quot;</span>: &#123;<span class="string">&quot;has_continuity_issues&quot;</span>: <span class="literal">False</span>, <span class="string">&quot;issues&quot;</span>: [], <span class="string">&quot;warnings&quot;</span>: [<span class="string">f&quot;审查过程出错: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>]&#125;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<h3 id="LangGraph-流程编排">LangGraph 流程编排</h3>
<p>多智能体协作流程，负责协调各个智能体完成端到端的分镜生成</p>
<img src= "/img/20241215205335173426721579192.webp" data-lazy-src="/imgs/ai/mermaid-diagram.webp" alt="mermaid-diagram" style="zoom:50%;" />
<p>通过 <code>InMemorySaver</code> 编译工作流</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">_init_agents</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;初始化各个智能体&quot;&quot;&quot;</span></span><br><span class="line">    debug(<span class="string">&quot;初始化智能体组件&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">self</span>.script_parser = ScriptParserAgent(llm=<span class="variable language_">self</span>.llm)</span><br><span class="line">    <span class="variable language_">self</span>.temporal_planner = TemporalPlannerAgent()</span><br><span class="line">    <span class="variable language_">self</span>.continuity_guardian = ContinuityGuardianAgent()</span><br><span class="line">    <span class="variable language_">self</span>.shot_generator = ShotGeneratorAgent(llm=<span class="variable language_">self</span>.llm)</span><br><span class="line">    <span class="variable language_">self</span>.qa_agent = QAAgent(llm=<span class="variable language_">self</span>.llm)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 初始化工作流节点集合</span></span><br><span class="line">    <span class="variable language_">self</span>.workflow_nodes = WorkflowNodes(</span><br><span class="line">        script_parser=<span class="variable language_">self</span>.script_parser,</span><br><span class="line">        temporal_planner=<span class="variable language_">self</span>.temporal_planner,</span><br><span class="line">        continuity_guardian=<span class="variable language_">self</span>.continuity_guardian,</span><br><span class="line">        shot_generator=<span class="variable language_">self</span>.shot_generator,</span><br><span class="line">        qa_agent=<span class="variable language_">self</span>.qa_agent,</span><br><span class="line">        llm=<span class="variable language_">self</span>.llm</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_init_workflow</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;初始化基于LangGraph的工作流&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建状态图</span></span><br><span class="line">    workflow = StateGraph(StoryboardWorkflowState)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 定义工作流节点</span></span><br><span class="line">    workflow.add_node(<span class="string">&quot;parse_script&quot;</span>, <span class="variable language_">self</span>.workflow_nodes.parse_script_node)</span><br><span class="line">    workflow.add_node(<span class="string">&quot;plan_timeline&quot;</span>, <span class="variable language_">self</span>.workflow_nodes.plan_timeline_node)</span><br><span class="line">    workflow.add_node(<span class="string">&quot;generate_shot&quot;</span>, <span class="variable language_">self</span>.workflow_nodes.generate_shot_node)</span><br><span class="line">    workflow.add_node(<span class="string">&quot;review_shot&quot;</span>, <span class="variable language_">self</span>.workflow_nodes.review_shot_node)</span><br><span class="line">    workflow.add_node(<span class="string">&quot;extract_continuity&quot;</span>, <span class="variable language_">self</span>.workflow_nodes.extract_continuity_node)</span><br><span class="line">    workflow.add_node(<span class="string">&quot;review_sequence&quot;</span>, <span class="variable language_">self</span>.workflow_nodes.review_sequence_node)</span><br><span class="line">    workflow.add_node(<span class="string">&quot;fix_continuity&quot;</span>, <span class="variable language_">self</span>.workflow_nodes.fix_continuity_node)</span><br><span class="line">    workflow.add_node(<span class="string">&quot;generate_result&quot;</span>, <span class="variable language_">self</span>.workflow_nodes.generate_result_node)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 定义条件边，根据解析结果是否有效继续流程（工作流执行流程）</span></span><br><span class="line">    workflow.add_conditional_edges(</span><br><span class="line">        <span class="string">&quot;parse_script&quot;</span>,</span><br><span class="line">        <span class="keyword">lambda</span> state: <span class="string">&quot;continue&quot;</span>,  <span class="comment"># 始终继续到下一步</span></span><br><span class="line">        &#123;<span class="string">&quot;continue&quot;</span>: <span class="string">&quot;plan_timeline&quot;</span>&#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    workflow.add_conditional_edges(</span><br><span class="line">        <span class="string">&quot;plan_timeline&quot;</span>,</span><br><span class="line">        <span class="keyword">lambda</span> state: <span class="string">&quot;continue&quot;</span>,</span><br><span class="line">        &#123;<span class="string">&quot;continue&quot;</span>: <span class="string">&quot;generate_shot&quot;</span>&#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    workflow.add_conditional_edges(</span><br><span class="line">        <span class="string">&quot;generate_shot&quot;</span>,</span><br><span class="line">        <span class="keyword">lambda</span> state: <span class="string">&quot;continue&quot;</span>,</span><br><span class="line">        &#123;<span class="string">&quot;continue&quot;</span>: <span class="string">&quot;review_shot&quot;</span>&#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    workflow.add_conditional_edges(</span><br><span class="line">        <span class="string">&quot;review_shot&quot;</span>,</span><br><span class="line">        <span class="keyword">lambda</span> state: <span class="string">&quot;valid&quot;</span> <span class="keyword">if</span> state[<span class="string">&quot;qa_results&quot;</span>][-<span class="number">1</span>][<span class="string">&quot;is_valid&quot;</span>] <span class="keyword">else</span> <span class="string">&quot;invalid&quot;</span>,</span><br><span class="line">        &#123;<span class="string">&quot;valid&quot;</span>: <span class="string">&quot;extract_continuity&quot;</span>, <span class="string">&quot;invalid&quot;</span>: <span class="string">&quot;check_retry&quot;</span>&#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加检查重试逻辑的条件边</span></span><br><span class="line">    workflow.add_conditional_edges(</span><br><span class="line">        <span class="string">&quot;extract_continuity&quot;</span>,</span><br><span class="line">        <span class="keyword">lambda</span> state: <span class="string">&quot;next_segment&quot;</span> <span class="keyword">if</span> state[<span class="string">&quot;current_segment_index&quot;</span>] &lt; <span class="built_in">len</span>(state[<span class="string">&quot;segments&quot;</span>]) - <span class="number">1</span> <span class="keyword">else</span> <span class="string">&quot;review_sequence&quot;</span>,</span><br><span class="line">        &#123;<span class="string">&quot;next_segment&quot;</span>: <span class="string">&quot;generate_shot&quot;</span>, <span class="string">&quot;review_sequence&quot;</span>: <span class="string">&quot;review_sequence&quot;</span>&#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加自定义检查重试节点</span></span><br><span class="line">    workflow.add_node(<span class="string">&quot;check_retry&quot;</span>, <span class="variable language_">self</span>.workflow_nodes.check_retry_node)</span><br><span class="line">    workflow.add_conditional_edges(</span><br><span class="line">        <span class="string">&quot;check_retry&quot;</span>,</span><br><span class="line">        <span class="keyword">lambda</span> state: <span class="string">&quot;retry&quot;</span> <span class="keyword">if</span> state[<span class="string">&quot;retry_count&quot;</span>] &lt; state[<span class="string">&quot;max_retries&quot;</span>] <span class="keyword">else</span> <span class="string">&quot;use_current&quot;</span>,</span><br><span class="line">        &#123;<span class="string">&quot;retry&quot;</span>: <span class="string">&quot;generate_shot&quot;</span>, <span class="string">&quot;use_current&quot;</span>: <span class="string">&quot;extract_continuity&quot;</span>&#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    workflow.add_conditional_edges(</span><br><span class="line">        <span class="string">&quot;review_sequence&quot;</span>,</span><br><span class="line">        <span class="keyword">lambda</span> state: <span class="string">&quot;fix&quot;</span> <span class="keyword">if</span> state[<span class="string">&quot;sequence_qa&quot;</span>][<span class="string">&quot;has_continuity_issues&quot;</span>] <span class="keyword">else</span> <span class="string">&quot;done&quot;</span>,</span><br><span class="line">        &#123;<span class="string">&quot;fix&quot;</span>: <span class="string">&quot;fix_continuity&quot;</span>, <span class="string">&quot;done&quot;</span>: <span class="string">&quot;generate_result&quot;</span>&#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    workflow.add_conditional_edges(</span><br><span class="line">        <span class="string">&quot;fix_continuity&quot;</span>,</span><br><span class="line">        <span class="keyword">lambda</span> state: <span class="string">&quot;continue&quot;</span>,</span><br><span class="line">        &#123;<span class="string">&quot;continue&quot;</span>: <span class="string">&quot;generate_result&quot;</span>&#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 设置入口点</span></span><br><span class="line">    workflow.set_entry_point(<span class="string">&quot;parse_script&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 编译工作流</span></span><br><span class="line">    <span class="keyword">return</span> workflow.<span class="built_in">compile</span>(checkpointer=<span class="variable language_">self</span>.memory)</span><br></pre></td></tr></table></figure>
<h3 id="LlamaIndex-向量检索">LlamaIndex 向量检索</h3>
<h3 id="LangChain-状态记忆">LangChain 状态记忆</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong>保存对话历史</strong>：让 LLM 知道上下文</p>
</li>
<li class="lvl-2">
<p><strong>维护状态</strong>：跟踪用户偏好、任务进度</p>
</li>
<li class="lvl-2">
<p><strong>支持多轮交互</strong>：如填表、分步任务</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>类型</th>
<th>适用场景</th>
<th>特点</th>
</tr>
</thead>
<tbody>
<tr>
<td>ConversationBufferMemory</td>
<td>简单对话（基础记忆）</td>
<td>保存全部历史（可能超 token）</td>
</tr>
<tr>
<td>ConversationBufferWindowMemory</td>
<td>长对话（窗口记忆）</td>
<td>仅保存最近 N 轮</td>
</tr>
<tr>
<td>ConversationSummaryMemory</td>
<td>超长对话（摘要记忆）</td>
<td>用 LLM 生成摘要</td>
</tr>
<tr>
<td>EntityMemory</td>
<td>实体跟踪（实体记忆）</td>
<td>记住人物/物品属性</td>
</tr>
<tr>
<td>VectorStoreRetrieverMemory</td>
<td>知识库问答（向量记忆）</td>
<td>从向量库检索相关记忆</td>
</tr>
<tr>
<td>ConversationBufferMemory<br />RedisChatMessageHistory</td>
<td>Redis 持久化</td>
<td>持久化到数据库</td>
</tr>
</tbody>
</table>
<h3 id="LangChain-提示词模板">LangChain 提示词模板</h3>
<h3 id="LangChain-LLM调用">LangChain LLM调用</h3>
<h3 id="LangChain-工具集">LangChain 工具集</h3>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://pengline.github.io">余一叶知秋尽</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://pengline.github.io/2025/10/0194020a663c408fb500dd7532349519/">https://pengline.github.io/2025/10/0194020a663c408fb500dd7532349519/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://pengline.github.io" target="_blank">余一叶知秋尽</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%89%A7%E6%9C%AC%E5%88%86%E9%95%9C/">剧本分镜</a><a class="post-meta__tags" href="/tags/%E5%89%A7%E6%9C%AC%E6%8B%86%E5%88%86/">剧本拆分</a><a class="post-meta__tags" href="/tags/%E9%95%BF%E5%89%A7%E6%9C%AC%E5%88%86%E9%95%9C/">长剧本分镜</a><a class="post-meta__tags" href="/tags/%E9%95%BF%E5%89%A7%E6%9C%AC%E8%A7%86%E9%A2%91%E7%94%9F%E6%88%90/">长剧本视频生成</a><a class="post-meta__tags" href="/tags/LlamaIndex%E5%90%91%E9%87%8F%E6%A3%80%E7%B4%A2/">LlamaIndex向量检索</a><a class="post-meta__tags" href="/tags/LangGraph%E6%B5%81%E7%A8%8B%E7%BC%96%E6%8E%92/">LangGraph流程编排</a></div><div class="post-share"><div class="social-share" data-image="/img/essay/1745748274531174574827442.webp" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/10/1332727d5b8a4fdc9cfbfd3661f009d4/" title="AI 模型的多种轻量化压缩技术"><img class="cover" src= "/img/20241215205335173426721579192.webp" data-lazy-src="/img/essay/1745746446968174574644625.webp" onerror="onerror=null;src='/img/k3zssqvjw2d.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">AI 模型的多种轻量化压缩技术</div></div><div class="info-2"><div class="info-item-1">模型轻量化不是单一技术，而是组合策略（轻量结构设计 → 知识蒸馏 → 结构化剪枝 → 量化感知训练 → 硬件部署）。</div></div></div></a></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%A7%E6%9C%AC%E5%88%86%E9%95%9C%E6%99%BA%E8%83%BD%E4%BD%93"><span class="toc-number">1.</span> <span class="toc-text">剧本分镜智能体</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%9B%AE%E6%A0%87"><span class="toc-number">1.1.</span> <span class="toc-text">核心目标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.2.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA"><span class="toc-number">1.3.</span> <span class="toc-text">输入输出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E6%88%90%E6%96%B9%E5%BC%8F"><span class="toc-number">1.4.</span> <span class="toc-text">集成方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84%EF%BC%88%E5%A4%9A%E6%99%BA%E8%83%BD%E4%BD%93%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">技术架构（多智能体）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%A7%E6%9C%AC%E8%A7%A3%E6%9E%90%E6%99%BA%E8%83%BD%E4%BD%93"><span class="toc-number">2.1.</span> <span class="toc-text">剧本解析智能体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E5%BA%8F%E8%A7%84%E5%88%92%E6%99%BA%E8%83%BD%E4%BD%93"><span class="toc-number">2.2.</span> <span class="toc-text">时序规划智能体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E7%BB%AD%E6%80%A7%E5%AE%88%E6%8A%A4%E6%99%BA%E8%83%BD%E4%BD%93"><span class="toc-number">2.3.</span> <span class="toc-text">连续性守护智能体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%95%9C%E7%94%9F%E6%88%90%E6%99%BA%E8%83%BD%E4%BD%93"><span class="toc-number">2.4.</span> <span class="toc-text">分镜生成智能体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%A8%E9%87%8F%E5%AE%A1%E6%9F%A5%E6%99%BA%E8%83%BD%E4%BD%93"><span class="toc-number">2.5.</span> <span class="toc-text">质量审查智能体</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%99%BA%E8%83%BD%E4%BD%93%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82"><span class="toc-number">3.</span> <span class="toc-text">智能体实现细节</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%E5%8F%8A%E5%8A%A8%E4%BD%9C%E6%97%B6%E9%95%BF"><span class="toc-number">3.1.</span> <span class="toc-text">场景及动作时长</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E7%A4%BA%E5%B7%A5%E7%A8%8B%E7%AE%A1%E7%90%86"><span class="toc-number">3.2.</span> <span class="toc-text">提示工程管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%B5%81%E8%8A%82%E7%82%B9%E5%AE%9A%E4%B9%89"><span class="toc-number">3.3.</span> <span class="toc-text">工作流节点定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LangGraph-%E6%B5%81%E7%A8%8B%E7%BC%96%E6%8E%92"><span class="toc-number">3.4.</span> <span class="toc-text">LangGraph 流程编排</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LlamaIndex-%E5%90%91%E9%87%8F%E6%A3%80%E7%B4%A2"><span class="toc-number">3.5.</span> <span class="toc-text">LlamaIndex 向量检索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LangChain-%E7%8A%B6%E6%80%81%E8%AE%B0%E5%BF%86"><span class="toc-number">3.6.</span> <span class="toc-text">LangChain 状态记忆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LangChain-%E6%8F%90%E7%A4%BA%E8%AF%8D%E6%A8%A1%E6%9D%BF"><span class="toc-number">3.7.</span> <span class="toc-text">LangChain 提示词模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LangChain-LLM%E8%B0%83%E7%94%A8"><span class="toc-number">3.8.</span> <span class="toc-text">LangChain LLM调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LangChain-%E5%B7%A5%E5%85%B7%E9%9B%86"><span class="toc-number">3.9.</span> <span class="toc-text">LangChain 工具集</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By 余一叶知秋尽</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.3</a></span></div><div class="footer_custom_text"><p><a style="margin-inline:5px"target="_blank"href="https://github.com/"><img src= "/img/20241215205335173426721579192.webp" data-lazy-src="https://img.shields.io/badge/Hosted-Github-brightgreen?style=flat&logo=GitHub"title="本站项目由Gtihub托管"></a><a style="margin-inline:5px"target="_blank"href="https://hexo.io/"><img src= "/img/20241215205335173426721579192.webp" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo"title="博客框架为Hexo"></a><a style="margin-inline:5px"target="_blank"href="https://butterfly.js.org/"><img src= "/img/20241215205335173426721579192.webp" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?logoColor=white&style=flat&logo=buefy"title="主题采用butterfly"></a><a style="margin-inline:5px"target="_blank"href="https://giscus.app/zh-CN/"><img src= "/img/20241215205335173426721579192.webp" data-lazy-src="https://img.shields.io/badge/Comment-Giscus-2873df?logoColor=white&style=flat&logo=git"title="评论系统为Giscus"></a><a style="margin-inline:5px"target="_blank"href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src= "/img/20241215205335173426721579192.webp" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris"title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><a class="icon-V hidden" onclick="switchNightMode()" title="日间和夜间模式切换"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getGiscusTheme = theme => theme === 'dark' ? 'dark' : 'light'

  const createScriptElement = config => {
    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => {
      ele.setAttribute(key, value)
    })
    return ele
  }

  const loadGiscus = (el = document, key) => {
    const mappingConfig = isShuoshuo
      ? { 'data-mapping': 'specific', 'data-term': key }
      : { 'data-mapping': (option && option['data-mapping']) || 'pathname' }

    const giscusConfig = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'pengline/pengline.github.io',
      'data-repo-id': 'R_kgDOPqG50w',
      'data-category-id': 'DIC_kwDOPqG5084Cu_K9',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      'data-lang': 'zh-CN',
      'data-input-position': 'top',
      async: true,
      ...option,
      ...mappingConfig
    }

    const scriptElement = createScriptElement(giscusConfig)

    el.querySelector('#giscus-wrap').appendChild(scriptElement)

    if (isShuoshuo) {
      window.shuoshuoComment.destroyGiscus = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const changeGiscusTheme = theme => {
    const iframe = document.querySelector('#giscus-wrap iframe')
    if (iframe) {
      const message = {
        giscus: {
          setConfig: {
            theme: getGiscusTheme(theme),
            lang: 'zh-CN'
          }
        }
      }
      iframe.contentWindow.postMessage(message, 'https://giscus.app')
    }
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if (isShuoshuo) {
    'Giscus' === 'Giscus'
      ? window.shuoshuoComment = { loadComment: loadGiscus }
      : window.loadOtherComment = loadGiscus
    return
  }

  if ('Giscus' === 'Giscus' || !false) {
    if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment = loadGiscus
  }
})()</script></div><script src="/js/custom/sun_moon.js" async></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>